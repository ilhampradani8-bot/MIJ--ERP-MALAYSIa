<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pengaturan</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        body { 
            background-color: #f8f9fa; 
            font-family: 'Segoe UI', sans-serif; 
            padding: 20px; 
            
            /* INI SOLUSINYA: */
            /* Kita kasih jarak kosong besar di bawah biar tombol GAK TENGGELAM */
            padding-bottom: 150px; 
        }
        .card-settings { border: none; border-radius: 12px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); margin-bottom: 20px; }
        .form-label { font-weight: 600; color: #555; font-size: 0.9rem; }
    </style>
</head>
<body>

    <h4 class="fw-bold mb-4"><i class="fas fa-cog me-2 text-secondary"></i>Pengaturan</h4>

    <div class="card card-settings bg-white p-4">
        <h6 class="fw-bold text-primary mb-3 border-bottom pb-2">Profil Usaha</h6>
        <div class="mb-3">
            <label class="form-label">Nama Perusahaan / Toko</label>
            <input type="text" id="comp-name" class="form-control" placeholder="Contoh: MIJ Digital">
        </div>
        <div class="mb-3">
            <label class="form-label">Slogan / Tagline</label>
            <input type="text" id="comp-tagline" class="form-control" placeholder="Solusi Digital Terbaik">
        </div>
        <div class="mb-3">
            <label class="form-label">Alamat Lengkap</label>
            <textarea id="comp-addr" class="form-control" rows="2"></textarea>
        </div>
        <div class="row">
            <div class="col-6 mb-3">
                <label class="form-label">Email</label>
                <input type="email" id="comp-email" class="form-control">
            </div>
            <div class="col-6 mb-3">
                <label class="form-label">No. HP / WA</label>
                <input type="text" id="comp-phone" class="form-control">
            </div>
        </div>
    </div>

    <div class="card card-settings bg-white p-4">
        <h6 class="fw-bold text-success mb-3 border-bottom pb-2">Info Rekening (Untuk Invoice)</h6>
        <div class="mb-3">
            <label class="form-label">Nama Bank</label>
            <select id="bank-name" class="form-select">
                <option value="">Pilih Bank...</option>
                <option value="BCA">BCA</option>
                <option value="MANDIRI">MANDIRI</option>
                <option value="BRI">BRI</option>
                <option value="BNI">BNI</option>
                <option value="MAYBANK">MAYBANK</option>
                <option value="CIMB">CIMB NIAGA</option>
                <option value="JAGO">BANK JAGO</option>
            </select>
        </div>
        <div class="mb-3">
            <label class="form-label">Nomor Rekening</label>
            <input type="number" id="bank-acc" class="form-control" placeholder="Contoh: 1234567890">
        </div>
        <div class="mb-3">
            <label class="form-label">Atas Nama (Holder)</label>
            <input type="text" id="bank-holder" class="form-control" placeholder="Nama Pemilik Rekening">
        </div>
    </div>

    <div class="d-grid gap-2 mb-5">
        <button class="btn btn-primary btn-lg fw-bold rounded-pill shadow-sm" onclick="saveSettings()">
            <i class="fas fa-save me-2"></i>SIMPAN PENGATURAN
        </button>
    </div>

    <div class="card card-settings bg-danger bg-opacity-10 p-3 mt-5 border border-danger">
        <h6 class="fw-bold text-danger"><i class="fas fa-exclamation-triangle me-2"></i>Zona Bahaya</h6>
        <p class="small text-muted mb-3">Gunakan tombol ini jika data error atau ingin memulai ulang dari nol di perangkat ini.</p>
        <button class="btn btn-outline-danger btn-sm w-100" onclick="resetFactory()">
            <i class="fas fa-trash me-2"></i>Reset Data Pabrik (Hapus Lokal)
        </button>
    </div>

    <script>
        // --- LOGIC ---
        function getDB() { return window.parent.MIJ_DB.getAllData(); }
        function saveToDB(data) { window.parent.MIJ_DB.saveData(data); }

        // 1. LOAD DATA SAAT DIBUKA
        document.addEventListener('DOMContentLoaded', () => {
            const db = getDB();
            const s = db.settings || {};

            document.getElementById('comp-name').value = s.companyName || '';
            document.getElementById('comp-tagline').value = s.tagline || '';
            document.getElementById('comp-addr').value = s.address || '';
            document.getElementById('comp-email').value = s.email || '';
            document.getElementById('comp-phone').value = s.phone || '';
            
            document.getElementById('bank-name').value = s.bankName || '';
            document.getElementById('bank-acc').value = s.bankAccount || '';
            document.getElementById('bank-holder').value = s.bankHolder || '';
        });

        // 2. FUNGSI SIMPAN
        function saveSettings() {
            let db = getDB();
            
            db.settings = {
                companyName: document.getElementById('comp-name').value,
                tagline: document.getElementById('comp-tagline').value,
                address: document.getElementById('comp-addr').value,
                email: document.getElementById('comp-email').value,
                phone: document.getElementById('comp-phone').value,
                bankName: document.getElementById('bank-name').value,
                bankAccount: document.getElementById('bank-acc').value,
                bankHolder: document.getElementById('bank-holder').value
            };

            saveToDB(db);
            window.parent.Swal.fire({
                icon: 'success', 
                title: 'Tersimpan!', 
                text: 'Info perusahaan & rekening telah diupdate.',
                timer: 1500,
                showConfirmButton: false
            });
        }

        // 3. FUNGSI RESET PABRIK (PENTING BUAT SUPABASE)
        function resetFactory() {
            window.parent.Swal.fire({
                title: 'Yakin Reset Data?',
                text: "Semua data di HP ini akan dihapus bersih! (Data di Server Supabase tetap aman).",
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#d33',
                confirmButtonText: 'Ya, Reset HP Ini'
            }).then((result) => {
                if (result.isConfirmed) {
                    localStorage.removeItem('MIJ_ERP_v2'); // Hapus Key Database
                    window.parent.location.reload(); // Refresh Total
                }
            });
        }
    </script>
</body>
</html>